# å‰ç«¯æ•°æ®ç¼“å­˜ç­–ç•¥

## æ¦‚è¿°

ä¸ºäº†æå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œç³»ç»Ÿå®ç°äº†åŸºäºæ—¶é—´æˆ³çš„æ•°æ®ç¼“å­˜ç­–ç•¥ã€‚ç¼“å­˜é€šè¿‡ Pinia Store (`src/store/cache.js`) ç»Ÿä¸€ç®¡ç†ã€‚

## ç¼“å­˜é…ç½®

- **ç¼“å­˜æœ‰æ•ˆæœŸ (TTL)**: 5åˆ†é’Ÿ
- **ç¼“å­˜ç­–ç•¥**: æ—¶é—´æˆ³éªŒè¯
- **å­˜å‚¨ä½ç½®**: Pinia Store (å†…å­˜ç¼“å­˜)

## ç¼“å­˜çš„æ•°æ®ç±»å‹

### 1. ç”¨æˆ·è§’è‰²å’ŒèŒè´£ (Roles Cache)
- **ç”¨é€”**: ç¼“å­˜ç”¨æˆ·å…³è”çš„å²—ä½ã€èŒè´£å’Œä»»åŠ¡ç±»å‹
- **ä½¿ç”¨åœºæ™¯**: åˆ›å»ºä»»åŠ¡æ—¶é€‰æ‹©èŒè´£ï¼Œé¢‘ç¹è®¿é—®
- **å¤±æ•ˆæ—¶æœº**: ç”¨æˆ·è§’è‰²å˜æ›´æ—¶

### 2. å›¢é˜Ÿæˆå‘˜æ•°æ® (Team Members Cache)
- **ç”¨é€”**: ç¼“å­˜ç®¡ç†è€…çš„å›¢é˜Ÿæˆå‘˜åˆ—è¡¨
- **ä½¿ç”¨åœºæ™¯**: å›¢é˜Ÿè§†å›¾é¡µé¢
- **å¤±æ•ˆæ—¶æœº**: å›¢é˜Ÿæˆå‘˜å˜æ›´æ—¶

### 3. ä»»åŠ¡åˆ—è¡¨ (Tasks Cache)
- **ç”¨é€”**: æŒ‰å‘¨å’Œç­›é€‰æ¡ä»¶ç¼“å­˜ä»»åŠ¡åˆ—è¡¨
- **ä½¿ç”¨åœºæ™¯**: ä»»åŠ¡åˆ—è¡¨é¡µé¢ã€ä»ªè¡¨ç›˜
- **ç¼“å­˜é”®æ ¼å¼**: `tasks_{year}_w{week}_key{is_key}_status{status}`
- **å¤±æ•ˆæ—¶æœº**:
  - åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ä»»åŠ¡æ—¶
  - æ‰¹é‡æ“ä½œæ—¶

### 4. ä»ªè¡¨ç›˜æ•°æ® (Dashboard Cache)
- **ç”¨é€”**: ç¼“å­˜å‘˜å·¥ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®
- **ä½¿ç”¨åœºæ™¯**: ä¸»ä»ªè¡¨ç›˜é¡µé¢
- **å¤±æ•ˆæ—¶æœº**: ä»»åŠ¡æ•°æ®å˜æ›´æ—¶

## ä½¿ç”¨æ–¹æ³•

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç¼“å­˜

```javascript
import { useCacheStore } from '@/store/cache'

const cacheStore = useCacheStore()

// è·å–ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœç¼“å­˜æœ‰æ•ˆåˆ™è¿”å›ç¼“å­˜ï¼Œå¦åˆ™è°ƒç”¨fetchFnè·å–æ–°æ•°æ®ï¼‰
const loadData = async () => {
  const data = await cacheStore.getTasksCache(cacheKey, async () => {
    return await apiCall(params)
  })
  // ä½¿ç”¨ data
}
```

### ä½¿ç¼“å­˜å¤±æ•ˆ

```javascript
// å½“æ•°æ®å˜æ›´æ—¶ï¼Œä½¿ç›¸å…³ç¼“å­˜å¤±æ•ˆ
await updateTask(taskId, updates)

// æ¸…é™¤ç›¸å…³ç¼“å­˜
cacheStore.invalidateTasks()       // æ¸…é™¤æ‰€æœ‰ä»»åŠ¡ç¼“å­˜
cacheStore.invalidateDashboard()   // æ¸…é™¤ä»ªè¡¨ç›˜ç¼“å­˜
```

## ç¼“å­˜å·¥ä½œæµç¨‹

```
1. ç»„ä»¶è¯·æ±‚æ•°æ®
   â†“
2. æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ (timestamp < 5åˆ†é’Ÿ)
   â†“
3a. ç¼“å­˜æœ‰æ•ˆ â†’ ç›´æ¥è¿”å›ç¼“å­˜æ•°æ® (å¿«é€Ÿå“åº”)
3b. ç¼“å­˜å¤±æ•ˆ â†’ è°ƒç”¨APIè·å–æ–°æ•°æ®
   â†“
4. æ›´æ–°ç¼“å­˜å¹¶è¿”å›æ•°æ®
   â†“
5. æ•°æ®å˜æ›´æ—¶æ¸…é™¤ç›¸å…³ç¼“å­˜
```

## ä¼˜åŠ¿

1. **å‡å°‘APIè¯·æ±‚**: 5åˆ†é’Ÿå†…é‡å¤è®¿é—®ç›´æ¥ä½¿ç”¨ç¼“å­˜
2. **æå‡å“åº”é€Ÿåº¦**: ç¼“å­˜å‘½ä¸­æ—¶å‡ ä¹ç¬æ—¶å“åº”
3. **é™ä½æœåŠ¡å™¨è´Ÿè½½**: å‡å°‘ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢
4. **æ”¹å–„ç”¨æˆ·ä½“éªŒ**: é¡µé¢åˆ‡æ¢æ›´æµç•…

## è°ƒè¯•

åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ç¼“å­˜æ—¥å¿—:

```
[Cache] Using cached tasks data for tasks_2025_w47_keyall_statusall
[Cache] Fetching fresh dashboard data
[Cache] Invalidating tasks cache
```

## ç¼“å­˜ç»Ÿè®¡

```javascript
// è·å–ç¼“å­˜çŠ¶æ€
const stats = cacheStore.getCacheStats()
console.log(stats)
// {
//   roles: { cached: true, timestamp: 1700000000000 },
//   teamMembers: { cached: false, timestamp: null },
//   tasks: { count: 3, keys: [...] },
//   dashboard: { cached: true, timestamp: 1700000000000 }
// }
```

## æ³¨æ„äº‹é¡¹

1. **ç¼“å­˜å¤±æ•ˆç­–ç•¥**: ä»»ä½•æ•°æ®å˜æ›´æ“ä½œåå¿…é¡»è°ƒç”¨å¯¹åº”çš„ `invalidate` æ–¹æ³•
2. **ç¼“å­˜é”®è®¾è®¡**: ä»»åŠ¡ç¼“å­˜é”®åŒ…å«æ‰€æœ‰ç­›é€‰æ¡ä»¶ï¼Œç¡®ä¿ä¸åŒç­›é€‰æ¡ä»¶æœ‰ç‹¬ç«‹ç¼“å­˜
3. **å†…å­˜ç®¡ç†**: ç¼“å­˜å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¡µé¢åˆ·æ–°åæ¸…ç©º
4. **æœªæ¥æ‰©å±•**: å¯è€ƒè™‘ä½¿ç”¨ localStorage å®ç°æŒä¹…åŒ–ç¼“å­˜

## å·²é›†æˆç¼“å­˜çš„ç»„ä»¶

- âœ… `Dashboard.vue` - ä»ªè¡¨ç›˜æ•°æ®ç¼“å­˜
- âœ… `Tasks.vue` - ä»»åŠ¡åˆ—è¡¨ç¼“å­˜
- ğŸ”œ `Team.vue` - å›¢é˜Ÿæˆå‘˜ç¼“å­˜ (å¾…é›†æˆ)
- ğŸ”œ `Review.vue` - å¤ç›˜æ•°æ®ç¼“å­˜ (å¾…é›†æˆ)

## æ€§èƒ½æ”¶ç›Š

å‡è®¾åœºæ™¯ï¼šç”¨æˆ·åœ¨5åˆ†é’Ÿå†…å¤šæ¬¡è®¿é—®ä»»åŠ¡åˆ—è¡¨

- **æ— ç¼“å­˜**: æ¯æ¬¡è®¿é—® = 1æ¬¡APIè¯·æ±‚ + 200mså“åº”æ—¶é—´
- **æœ‰ç¼“å­˜**: é¦–æ¬¡è®¿é—® = 1æ¬¡APIè¯·æ±‚ + 200msï¼Œåç»­è®¿é—® = 0æ¬¡APIè¯·æ±‚ + <10mså“åº”æ—¶é—´

**æ”¶ç›Š**:
- å“åº”é€Ÿåº¦æå‡ 95%
- APIè¯·æ±‚å‡å°‘ 80-90%
- ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿæ˜¾è‘—é™ä½
