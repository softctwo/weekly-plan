# å²—è´£é©±åŠ¨çš„å‘¨å·¥ä½œè®¡åˆ’ç®¡ç†ç³»ç»Ÿ - æµ‹è¯•æŒ‡å—

## ğŸ“‹ ç›®å½•

- [æµ‹è¯•æ¦‚è§ˆ](#æµ‹è¯•æ¦‚è§ˆ)
- [æµ‹è¯•ç¯å¢ƒé…ç½®](#æµ‹è¯•ç¯å¢ƒé…ç½®)
- [åç«¯æµ‹è¯•](#åç«¯æµ‹è¯•)
- [å‰ç«¯æµ‹è¯•](#å‰ç«¯æµ‹è¯•)
- [ç«¯åˆ°ç«¯æµ‹è¯•](#ç«¯åˆ°ç«¯æµ‹è¯•)
- [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)
- [CI/CDé›†æˆ](#cicdé›†æˆ)
- [æµ‹è¯•è¦†ç›–ç‡](#æµ‹è¯•è¦†ç›–ç‡)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

## ğŸ¯ æµ‹è¯•æ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨å¤šå±‚æ¬¡æµ‹è¯•ç­–ç•¥ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§ï¼š

```
æµ‹è¯•é‡‘å­—å¡”
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   E2E æµ‹è¯•       â”‚  â† ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹æµ‹è¯•
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   æ€§èƒ½æµ‹è¯•          â”‚  â† æ€§èƒ½å’Œè´Ÿè½½æµ‹è¯•
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯å•å…ƒæµ‹è¯•         â”‚  â† Vueç»„ä»¶æµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯å•å…ƒæµ‹è¯•         â”‚  â† APIå’Œä¸šåŠ¡é€»è¾‘æµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•ç±»å‹åˆ†å¸ƒ

| æµ‹è¯•ç±»å‹ | æ¡†æ¶ | è¦†ç›–èŒƒå›´ | æ‰§è¡Œé¢‘ç‡ |
|---------|------|---------|---------|
| å•å…ƒæµ‹è¯• | pytest/Vitest | ä¸šåŠ¡é€»è¾‘ã€å·¥å…·å‡½æ•° | æ¯æ¬¡æäº¤ |
| é›†æˆæµ‹è¯• | pytest | APIç«¯ç‚¹ã€æ•°æ®åº“æ“ä½œ | æ¯æ¬¡æäº¤ |
| E2Eæµ‹è¯• | Playwright | ç”¨æˆ·æµç¨‹ã€ç•Œé¢äº¤äº’ | æ¯æ¬¡PR/ä¸»åˆ†æ”¯ |
| æ€§èƒ½æµ‹è¯• | Lighthouse/Artillery | é¡µé¢æ€§èƒ½ã€APIè´Ÿè½½ | æ¯æ¬¡ä¸»åˆ†æ”¯ |

## ğŸ› ï¸ æµ‹è¯•ç¯å¢ƒé…ç½®

### åç«¯ç¯å¢ƒ

1. **å®‰è£…ä¾èµ–**
   ```bash
   cd backend
   pip install -r requirements.txt
   ```

2. **ç¯å¢ƒé…ç½®**
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’Œå¯†é’¥
   ```

3. **æ•°æ®åº“åˆå§‹åŒ–**
   ```bash
   python init_db.py
   ```

### å‰ç«¯ç¯å¢ƒ

1. **å®‰è£…ä¾èµ–**
   ```bash
   cd frontend
   npm install
   ```

2. **å®‰è£…æµ‹è¯•æµè§ˆå™¨**
   ```bash
   npx playwright install
   ```

## ğŸ åç«¯æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
pytest tests/ -m unit          # å•å…ƒæµ‹è¯•
pytest tests/ -m integration   # é›†æˆæµ‹è¯•
pytest tests/ -m api           # APIæµ‹è¯•

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=app --cov-report=html

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_auth.py -v
```

### åç«¯æµ‹è¯•ç»“æ„

```
backend/tests/
â”œâ”€â”€ conftest.py              # pytesté…ç½®å’Œfixtures
â”œâ”€â”€ test_auth.py             # è®¤è¯åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_api_*.py           # APIç«¯ç‚¹æµ‹è¯•
â”œâ”€â”€ test_models.py           # æ•°æ®æ¨¡å‹æµ‹è¯•
â”œâ”€â”€ test_init_data.py        # åˆå§‹åŒ–æ•°æ®æµ‹è¯•
â””â”€â”€ test_tasks.py            # ä»»åŠ¡ç®¡ç†æµ‹è¯•
```

### æµ‹è¯•æ ‡è®°

- `@pytest.mark.unit`: å•å…ƒæµ‹è¯•
- `@pytest.mark.integration`: é›†æˆæµ‹è¯•
- `@pytest.mark.api`: APIæµ‹è¯•
- `@pytest.mark.slow`: æ…¢é€Ÿæµ‹è¯•

## ğŸŒ å‰ç«¯æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡
npm run test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch

# æ‰“å¼€æµ‹è¯•UI
npm run test:ui
```

### å‰ç«¯æµ‹è¯•ç»“æ„

```
frontend/tests/
â”œâ”€â”€ setup.js                 # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ Login.test.js            # ç™»å½•ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ Dashboard.test.js        # ä»ªè¡¨æ¿ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ SimpleComponent.test.js  # ç®€å•ç»„ä»¶æµ‹è¯•ç¤ºä¾‹
â””â”€â”€ utils.test.js            # å·¥å…·å‡½æ•°æµ‹è¯•

frontend/e2e/
â”œâ”€â”€ auth.spec.js             # è®¤è¯E2Eæµ‹è¯•
â”œâ”€â”€ dashboard.spec.js        # ä»ªè¡¨æ¿E2Eæµ‹è¯•
â””â”€â”€ performance.test.js      # æ€§èƒ½æµ‹è¯•
```

### ç»„ä»¶æµ‹è¯•æœ€ä½³å®è·µ

1. **ä½¿ç”¨æ­£ç¡®çš„æµ‹è¯•å·¥å…·**
   - `@vue/test-utils`: Vueç»„ä»¶æµ‹è¯•
   - `vitest`: æµ‹è¯•è¿è¡Œå™¨
   - `happy-dom`: è½»é‡çº§DOMæ¨¡æ‹Ÿ

2. **æµ‹è¯•ç»„ä»¶çš„å…³é”®æ–¹é¢**
   - æ¸²æŸ“æ­£ç¡®æ€§
   - Propså’Œäº‹ä»¶å¤„ç†
   - ç”¨æˆ·äº¤äº’
   - æ•°æ®å“åº”æ€§

3. **Mockå¤–éƒ¨ä¾èµ–**
   - APIè°ƒç”¨
   - æµè§ˆå™¨API
   - ç¬¬ä¸‰æ–¹åº“

## ğŸ­ ç«¯åˆ°ç«¯æµ‹è¯•

### è¿è¡ŒE2Eæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
npm run test:e2e

# ä½¿ç”¨UIæ¨¡å¼è¿è¡Œ
npm run test:e2e:ui

# æ˜¾ç¤ºæµè§ˆå™¨çª—å£è¿è¡Œ
npm run test:e2e:headed

# è°ƒè¯•æ¨¡å¼
npm run test:e2e:debug
```

### E2Eæµ‹è¯•è¦†ç›–èŒƒå›´

- **è®¤è¯æµç¨‹**: ç™»å½•ã€é€€å‡ºã€æƒé™éªŒè¯
- **ä¸»è¦åŠŸèƒ½**: ä»ªè¡¨æ¿ã€ä»»åŠ¡ç®¡ç†ã€ç”¨æˆ·ç®¡ç†
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯é€‚é…
- **é”™è¯¯å¤„ç†**: ç½‘ç»œé”™è¯¯ã€è¡¨å•éªŒè¯

### Playwrighté…ç½®ç‰¹æ€§

- **å¤šæµè§ˆå™¨æ”¯æŒ**: Chromeã€Firefoxã€Safari
- **å¹¶è¡Œæ‰§è¡Œ**: æé«˜æµ‹è¯•æ•ˆç‡
- **è‡ªåŠ¨é‡è¯•**: å¤„ç†å¶å‘å¤±è´¥
- **æˆªå›¾å’Œå½•å±**: å¤±è´¥æ—¶è‡ªåŠ¨è®°å½•
- **è¯¦ç»†æŠ¥å‘Š**: HTMLå’ŒJSONæ ¼å¼æŠ¥å‘Š

## âš¡ æ€§èƒ½æµ‹è¯•

### é¡µé¢æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
npm run test:e2e tests/performance.test.js
```

**æµ‹è¯•æŒ‡æ ‡:**
- é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP) < 1.8s
- æœ€å¤§å†…å®¹ç»˜åˆ¶ (LCP) < 2.5s
- é¡µé¢åŠ è½½æ—¶é—´ < 3s
- å†…å­˜å¢é•¿ < 50MB

### APIè´Ÿè½½æµ‹è¯•

```bash
# å®‰è£…Artillery
npm install -g artillery

# è¿è¡Œè´Ÿè½½æµ‹è¯•
artillery run performance-test.yml
```

**è´Ÿè½½æµ‹è¯•åœºæ™¯:**
- ç”¨æˆ·è®¤è¯æµç¨‹
- ä»ªè¡¨æ¿æ•°æ®è·å–
- ä»»åŠ¡ç®¡ç†æ“ä½œ
- å¹¶å‘ç”¨æˆ·æµ‹è¯•

## ğŸ”„ CI/CDé›†æˆ

### GitHub Actionså·¥ä½œæµ

```yaml
# ä¸»è¦æµ‹è¯•é˜¶æ®µ
1. backend-test      # åç«¯å•å…ƒæµ‹è¯• + ä»£ç è¦†ç›–ç‡
2. frontend-test     # å‰ç«¯å•å…ƒæµ‹è¯• + ESLint + æ„å»º
3. e2e-test         # ç«¯åˆ°ç«¯æµ‹è¯• (åˆ†ç‰‡å¹¶è¡Œ)
4. performance-test # æ€§èƒ½æµ‹è¯• (ä»…ä¸»åˆ†æ”¯)
5. security-scan    # å®‰å…¨æ‰«æ
6. docker-build     # Dockeré•œåƒæ„å»º
```

### æµ‹è¯•æŠ¥å‘Š

- **ä»£ç è¦†ç›–ç‡**: Codecové›†æˆ
- **E2Eæµ‹è¯•æŠ¥å‘Š**: GitHub Artifacts
- **æ€§èƒ½æŠ¥å‘Š**: Lighthouseå’ŒArtilleryæŠ¥å‘Š
- **å®‰å…¨æŠ¥å‘Š**: Trivyæ‰«æç»“æœ

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### åç«¯è¦†ç›–ç‡ç›®æ ‡

- **æ€»ä½“è¦†ç›–ç‡**: â‰¥ 70%
- **åˆ†æ”¯è¦†ç›–ç‡**: â‰¥ 65%
- **å‡½æ•°è¦†ç›–ç‡**: â‰¥ 80%

### å‰ç«¯è¦†ç›–ç‡ç›®æ ‡

- **æ€»ä½“è¦†ç›–ç‡**: â‰¥ 70%
- **ç»„ä»¶è¦†ç›–ç‡**: â‰¥ 80%
- **å·¥å…·å‡½æ•°è¦†ç›–ç‡**: â‰¥ 90%

### è¦†ç›–ç‡æŠ¥å‘ŠæŸ¥çœ‹

1. **åç«¯HTMLæŠ¥å‘Š**
   ```bash
   # è¿è¡Œæµ‹è¯•åæ‰“å¼€
   open backend/htmlcov/index.html
   ```

2. **å‰ç«¯è¦†ç›–ç‡æŠ¥å‘Š**
   ```bash
   # è¿è¡Œæµ‹è¯•åæ‰“å¼€
   open frontend/coverage/index.html
   ```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### åç«¯æµ‹è¯•é—®é¢˜

1. **æ•°æ®åº“è¿æ¥é”™è¯¯**
   ```bash
   # æ£€æŸ¥.envé…ç½®
   cat backend/.env

   # ä½¿ç”¨SQLiteæµ‹è¯•æ•°æ®åº“
   DATABASE_URL="sqlite:///./test.db"
   ```

2. **å¯¼å…¥é”™è¯¯**
   ```bash
   # æ£€æŸ¥Pythonè·¯å¾„å’Œæ¨¡å—å®‰è£…
   python -c "import app.main"
   ```

#### å‰ç«¯æµ‹è¯•é—®é¢˜

1. **æµè§ˆå™¨å®‰è£…å¤±è´¥**
   ```bash
   # æ‰‹åŠ¨å®‰è£…Playwrightæµè§ˆå™¨
   npx playwright install --with-deps chromium
   ```

2. **ç»„ä»¶æµ‹è¯•å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç»„ä»¶ä¾èµ–å’ŒMocké…ç½®
   npm run test:watch -- --reporter=verbose
   ```

#### E2Eæµ‹è¯•é—®é¢˜

1. **è¶…æ—¶é”™è¯¯**
   ```javascript
   // å¢åŠ ç­‰å¾…æ—¶é—´
   await page.waitForTimeout(5000)
   ```

2. **å…ƒç´ å®šä½å¤±è´¥**
   ```javascript
   // ä½¿ç”¨æ›´å¯é çš„é€‰æ‹©å™¨
   await page.locator('[data-testid="submit-button"]').click()
   ```

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨è°ƒè¯•æ¨¡å¼**
   ```bash
   # åç«¯è°ƒè¯•
   pytest tests/test_file.py -v -s --pdb

   # å‰ç«¯è°ƒè¯•
   npm run test:watch -- --inspect-brk

   # E2Eè°ƒè¯•
   npm run test:e2e:debug
   ```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   ```bash
   # åç«¯è¯¦ç»†è¾“å‡º
   pytest tests/ -v -s --tb=long

   # å‰ç«¯è¯¦ç»†è¾“å‡º
   npm run test -- --reporter=verbose
   ```

3. **é€‰æ‹©æ€§è¿è¡Œæµ‹è¯•**
   ```bash
   # è¿è¡Œç‰¹å®šæµ‹è¯•
   pytest tests/test_auth.py::TestAuth::test_login_success

   # è·³è¿‡æ…¢é€Ÿæµ‹è¯•
   pytest tests/ -m "not slow"
   ```

## ğŸ“ ç¼–å†™æµ‹è¯•æŒ‡å—

### åç«¯æµ‹è¯•ç¼–å†™

1. **ä½¿ç”¨Fixtures**
   ```python
   @pytest.fixture
   def test_user(db_session):
       user = User(username="test", email="test@example.com")
       db_session.add(user)
       db_session.commit()
       return user
   ```

2. **æµ‹è¯•APIç«¯ç‚¹**
   ```python
   def test_create_task(client, auth_headers, test_user):
       response = client.post(
           "/api/tasks",
           json={"title": "Test Task"},
           headers=auth_headers
       )
       assert response.status_code == 201
   ```

### å‰ç«¯æµ‹è¯•ç¼–å†™

1. **ç»„ä»¶æŒ‚è½½**
   ```javascript
   const wrapper = mount(MyComponent, {
       props: { title: "Test" },
       global: { plugins: [createPinia()] }
   })
   ```

2. **ç”¨æˆ·äº¤äº’æµ‹è¯•**
   ```javascript
   await wrapper.find('button').trigger('click')
   expect(wrapper.emitted()).toHaveProperty('custom-event')
   ```

### E2Eæµ‹è¯•ç¼–å†™

1. **é¡µé¢å¯¼èˆª**
   ```javascript
   await page.goto('/login')
   await expect(page).toHaveURL('/login')
   ```

2. **è¡¨å•æ“ä½œ**
   ```javascript
   await page.fill('input[name="username"]', 'testuser')
   await page.click('button[type="submit"]')
   ```

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

1. **æµ‹è¯•å‘½å**: ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
2. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
3. **æ•°æ®å‡†å¤‡**: ä½¿ç”¨fixtureså’Œå·¥å‚æ¨¡å¼
4. **æ–­è¨€æ¸…æ™°**: ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–­è¨€æ¶ˆæ¯
5. **æµ‹è¯•è¦†ç›–ç‡**: å…³æ³¨å…³é”®è·¯å¾„æµ‹è¯•
6. **å®šæœŸç»´æŠ¤**: åŠæ—¶æ›´æ–°è¿‡æœŸæµ‹è¯•
7. **æ–‡æ¡£æ›´æ–°**: ä¿æŒæµ‹è¯•æ–‡æ¡£åŒæ­¥

## ğŸ“š å‚è€ƒèµ„æº

- [Pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [Vitestå®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Playwrightå®˜æ–¹æ–‡æ¡£](https://playwright.dev/)
- [Vue Test Utilsæ–‡æ¡£](https://test-utils.vuejs.org/)
- [Artilleryæ–‡æ¡£](https://artillery.io/docs/)

---

**æ›´æ–°æ—¥æœŸ**: 2024-11-20
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
**ç‰ˆæœ¬**: v1.0