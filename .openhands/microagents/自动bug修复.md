---
name: 自动bug修复
type: knowledge
version: 1.0.0
agent: CodeActAgent
triggers: []
---

# 自动bug修复微代理

## 概述
本微代理提供自动bug检测和修复功能，专门为weekly-plan周工作计划管理系统设计。它能够识别常见bug模式，提供修复建议，并协助进行代码修复。

## 能力范围

### 1. Bug检测能力
- **代码语法错误检测**: 识别Python、JavaScript、Vue.js中的语法错误
- **运行时错误分析**: 分析常见的运行时异常模式
- **API接口错误**: 检测FastAPI后端接口定义和响应问题
- **前端组件错误**: 识别Vue组件中的props、事件、状态管理问题
- **数据库操作错误**: 检查SQLAlchemy模型和查询问题
- **配置错误**: 识别环境配置、依赖配置问题

### 2. 自动修复能力
- **语法错误修复**: 自动修正常见的语法错误
- **导入错误修复**: 修复缺失的导入语句
- **类型错误修复**: 修正类型不匹配问题
- **API响应格式修复**: 确保API响应符合FastAPI规范
- **前端状态管理修复**: 修复Vue组件状态同步问题
- **数据库迁移修复**: 协助修复数据库迁移脚本问题

### 3. 测试验证
- **单元测试修复**: 修复失败的单元测试
- **集成测试验证**: 验证API端到端测试
- **前端测试修复**: 修复Vue组件测试
- **测试覆盖率分析**: 识别测试覆盖不足的区域

## 使用指南

### 激活方式
本微代理没有特定的触发词，但可以在以下场景中主动使用：
1. 当用户报告bug时
2. 当测试失败时
3. 当代码审查发现问题时
4. 当部署过程中出现错误时

### 工作流程
1. **问题分析**: 首先分析bug报告或错误日志
2. **代码审查**: 检查相关代码文件
3. **根本原因定位**: 确定bug的根本原因
4. **修复方案设计**: 设计最小化的修复方案
5. **代码修改**: 实施修复
6. **测试验证**: 运行相关测试验证修复
7. **文档更新**: 更新相关文档（如需要）

### 常用命令
```bash
# 运行测试套件
python -m pytest backend/tests/

# 检查Python代码质量
pylint backend/

# 检查前端代码
cd frontend && npm run lint

# 运行完整测试
python test_comprehensive.py
```

## 项目特定指南

### weekly-plan项目结构
```
weekly-plan/
├── backend/           # FastAPI后端
│   ├── app/          # 应用代码
│   ├── models/       # 数据模型
│   ├── routes/       # API路由
│   └── tests/        # 后端测试
├── frontend/         # Vue.js前端
│   ├── src/         # 源代码
│   └── tests/       # 前端测试
└── 各种测试文件      # 综合测试
```

### 常见bug模式

#### 1. 后端常见问题
- **数据库连接错误**: 检查.env文件中的数据库配置
- **CORS配置问题**: 确保CORS中间件正确配置
- **JWT认证错误**: 验证token生成和验证逻辑
- **API响应格式**: 确保返回正确的Pydantic模型

#### 2. 前端常见问题
- **Vue组件通信**: 检查props和emit的使用
- **状态管理**: 验证Pinia store的状态更新
- **API调用**: 检查axios拦截器和错误处理
- **路由配置**: 验证Vue Router配置

#### 3. 集成问题
- **前后端数据格式**: 确保API响应能被前端正确解析
- **环境变量**: 检查开发和生产环境配置
- **部署配置**: 验证Docker和部署脚本

## 修复原则

### 1. 最小化变更
- 只修改必要的代码
- 避免引入不必要的重构
- 保持向后兼容性

### 2. 测试驱动
- 修复前先编写或运行测试
- 确保修复后所有测试通过
- 添加回归测试防止问题复发

### 3. 文档更新
- 更新代码注释说明修复原因
- 更新API文档（如需要）
- 更新部署文档（如配置变更）

### 4. 代码质量
- 遵循项目代码规范
- 运行代码检查工具
- 确保代码可读性和可维护性

## 工具和依赖

### 必需工具
- Python 3.9+
- Node.js 16+
- PostgreSQL/MySQL
- Docker（可选）

### 开发依赖
```bash
# 后端依赖
pip install -r backend/requirements.txt

# 前端依赖
cd frontend && npm install
```

### 测试工具
- pytest（Python测试）
- vitest（前端测试）
- playwright（端到端测试）

## 故障排除

### 快速诊断命令
```bash
# 检查后端服务状态
curl http://localhost:8000/health

# 检查前端构建
cd frontend && npm run build

# 检查数据库连接
python check_db_connection.py

# 运行完整测试套件
./run_all_tests.sh
```

### 常见错误解决方案

#### 1. 数据库连接失败
- 检查数据库服务是否运行
- 验证连接字符串格式
- 检查网络连接和防火墙设置

#### 2. 前端构建失败
- 检查Node.js版本兼容性
- 清理node_modules重新安装
- 检查package.json依赖冲突

#### 3. API调用失败
- 检查CORS配置
- 验证请求头格式
- 检查身份验证token

## 最佳实践

### 1. Bug报告模板
当用户报告bug时，建议收集以下信息：
- 错误消息和堆栈跟踪
- 复现步骤
- 环境信息（OS、浏览器、版本）
- 相关截图或日志

### 2. 修复优先级
1. **严重bug**: 导致系统崩溃或数据丢失
2. **主要bug**: 影响核心功能使用
3. **次要bug**: 影响用户体验但不阻塞功能
4. **优化建议**: 性能或UI改进

### 3. 代码审查要点
- 修复是否解决了根本原因
- 是否有副作用或回归风险
- 测试是否充分覆盖
- 文档是否需要更新

## 限制和注意事项

### 当前限制
- 无法修复需要人工判断的逻辑错误
- 无法处理需要业务知识理解的bug
- 复杂重构需要人工参与
- 第三方库的bug需要等待上游修复

### 安全注意事项
- 不要自动修复安全相关漏洞
- 敏感数据操作需要人工审核
- 权限和认证变更需要谨慎处理
- 生产环境修复需要充分测试

## 更新日志

### v1.0.0 (2025-12-02)
- 初始版本发布
- 支持weekly-plan项目常见bug模式
- 提供自动修复工作流程指南
- 包含项目特定故障排除指南